# ì‚¬ìš©í•  ëª¨ë“ˆ 
streamlit
numpy
pandas

import streamlit as st
from streamlit_folium import st_folium
from streamlit_folium import folium_static
import streamlit.components.v1 as components
import folium
import geopandas as gpd
import pandas as pd
import numpy as np
import seaborn as sns
from datetime import date
from datetime import datetime
import holidays
from statsmodels.tsa.seasonal import seasonal_decompose
import scipy.stats as stats
from statsmodels.tsa.stattools import adfuller
from sklearn.ensemble import IsolationForest
from sklearn.impute import SimpleImputer
from sklearn.preprocessing import MinMaxScaler
import matplotlib.dates as mdates
from matplotlib.dates import DateFormatter, YearLocator, MonthLocator
from matplotlib import container
import matplotlib.font_manager as fm
import matplotlib.pyplot as plt 
from matplotlib import rc
from PIL import Image

rc('font', family='AppleGothic')
plt.rcParams['axes.unicode_minus'] = False

# ë°ì´í„° 
# df_trade = pd.read_csv("/content/drive/MyDrive/á„€á…©á†¼á„†á…©á„Œá…¥á†«(Dacon)/international_trade.csv")
df_train = pd.read_csv("/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /dataset/temp_train(11.16) (1).csv")
df_test = pd.read_csv("/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /dataset/df_test.csv")
df_train['timestamp'] = pd.to_datetime(df_train['timestamp'])
df_train['timestamp'] = df_train['timestamp'].dt.date


# Minmax_scaling 
from sklearn.preprocessing import MinMaxScaler

def scale_columns(df, columns):
    scaler = MinMaxScaler()
    df[columns] = scaler.fit_transform(df[columns])
    return df

scaled_df = scale_columns(df_train, ['price(ì›/kg)','ìˆ˜ì… ê¸ˆì•¡'])
scaled_df1 = scale_columns(df_train, ['price(ì›/kg)','supply(kg)'])
 

# ì œëª© 
st.title("ì œì£¼ë„ :green[ì£¼ìš” ë†ì‚°ë¬¼] ë°ì´í„° ë¶„ì„ ğŸï¸")


# ì‚¬ì´ë“œë°” 
page = st.sidebar.selectbox(" ğŸŠ ì£¼ìš” ë†ì‚°ë¬¼ ë°ì´í„° ë¶„ì„ ", ["1) ë†ì‚°ë¬¼ ë°ì´í„°", "2) ì œì£¼ë„ ì§€ë„", "3) íƒìƒ‰ì  ë°ì´í„°ë¶„ì„(EDA)","4) ë°ì´í„° ì „ì²˜ë¦¬", "5) ëª¨ë¸ë§"])

if page == "1) ë†ì‚°ë¬¼ ë°ì´í„°": 
    st.header("ë†ì‚°ë¬¼ ë°ì´í„°", help = "TG : ê°ê·¤, BC : ë¸Œë¡œì½œë¦¬, RD : ë¬´, CR : ë‹¹ê·¼, CB : ì–‘ë°°ì¶” ")
    item = st.selectbox('item(í’ˆëª©)', options = df_train['item'].unique(), key='item_selectbox_1')
    corp = st.selectbox('corporation(ë²•ì¸)',options = df_train['corporation'].unique())
    location = st.selectbox('location(ì§€ì—­)',options = df_train['location'].unique())
    start_date = st.date_input("ì‹œì‘ ë‚ ì§œ", df_train['timestamp'].min())
    end_date = st.date_input("ì¢…ë£Œ ë‚ ì§œ", df_train['timestamp'].max())
    filtered_df = df_train[
    (df_train['item'] == item) &
    (df_train['timestamp'] >= start_date) &
    (df_train['timestamp'] <= end_date) &
    (df_train['corporation'] == corp) &
    (df_train['location'] == location)
]
    st.write(filtered_df)

    csv = filtered_df.to_csv(index=False)
 
    st.download_button(
        label = "file Download",
        data = csv,
        file_name="file.csv", 
        mime="text/csv"
    )
elif page == "2) ì œì£¼ë„ ì§€ë„":
    
    def load_data():
    # Shapefile ì½ê¸°
        gdf = gpd.read_file('/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /dataset/LARD_ADM_SECT_SGG_50.dbf', encoding='euc-kr')
        gdf.set_crs(epsg=4326, inplace=True, allow_override=True)
        return gdf

    def create_map(gdf):
    # ì œì£¼ë„ì˜ ì¤‘ì‹¬ ì¢Œí‘œ
        jeju_coordinates = [33.361666, 126.529166]

        corporations = {
            "A": [33.315, 126.199],  
            "B": [33.422, 126.308],  
            "C": [33.500, 126.782],  
            "D": [33.500, 126.638],  
            "E": [33.321, 126.688],  
            "F": [33.273, 126.560]   
    }

        colors = ['red', 'blue', 'green', 'purple', 'orange', 'darkred']

        # ê¸°ë³¸ ì§€ë„ ìƒì„±
        map_jeju = folium.Map(location=jeju_coordinates, zoom_start=10)

        def style_function(feature):
            if feature['properties']['SGG_NM'] == 'ì œì£¼ì‹œ':
                return {'fillColor':'green', 'color':'green', 'weight': 1.5, 'fillOpacity': 0.5}
            else:
                return {'fillColor': 'blue', 'color': 'blue', 'weight': 1.5, 'fillOpacity': 0.5}

        def highlight_function(feature):
            return {'fillColor': '#ffaf00', 'color': '#ffaf00', 'fillOpacity': 0.5, 'weight': 3}

        folium.GeoJson(
            gdf,
            name='jeju',
            style_function = style_function,
            highlight_function = highlight_function,
            tooltip=folium.GeoJsonTooltip(fields=['SGG_NM'], aliases=['ì§€ì—­:'])
        ).add_to(map_jeju)
        

        for (corporation, coords), color in zip(corporations.items(), colors):
            folium.CircleMarker(
                location=coords,
                radius=df_train[df_train['corporation'] == corporation]['price(ì›/kg)'].mean() * 1000,
                color=color,
                fill=True,
                fill_color=color,
                tooltip=f"{corporation}"
            ).add_to(map_jeju)



        for (corporation, coords), color in zip(corporations.items(), colors):
            folium.Marker(
                location=coords,
                icon=folium.Icon(color=color, icon='info-sign'),
                tooltip=f"{corporation}ìœ í†µë²•ì¸ íŒë§¤ëŸ‰"
                        ).add_to(map_jeju) 
        
        return map_jeju

    def main():
        st.subheader("ì œì£¼ë„ ìœ í†µë²•ì¸ ë³„ í‰ê·  íŒë§¤ëŸ‰")

        # ë°ì´í„° ë¡œë“œ
        gdf = load_data()

        # ì§€ë„ ìƒì„±
        map_jeju = create_map(gdf)

        # ì§€ë„ë¥¼ HTMLë¡œ ë³€í™˜í•˜ì—¬ Streamlit ì•±ì— í‘œì‹œ
        map_html = map_jeju._repr_html_()
        components.html(map_html, height=600)

    if __name__ == "__main__":
        main()

elif page == "3) íƒìƒ‰ì  ë°ì´í„°ë¶„ì„(EDA)":
    st.header("íƒìƒ‰ì  ë°ì´í„°ë¶„ì„(EDA)")

    st.subheader("1.ê¸°ìˆ í†µê³„")
    if st.checkbox("ê¸°ìˆ í†µê³„",help = "TG : ê°ê·¤, BC : ë¸Œë¡œì½œë¦¬, RD : ë¬´, CR : ë‹¹ê·¼, CB : ì–‘ë°°ì¶” ") : 
        item = st.selectbox('item(í’ˆëª©)', options = df_train['item'].unique(), key='item_selectbox_2')
        st.dataframe(df_train[df_train['item'] == item].describe())
    
    st.subheader("2.ìƒê´€ê´€ê³„ ë¶„ì„")
    if st.checkbox("ìƒê´€ê´€ê³„"):
        fig, ax = plt.subplots() 
        corr_matrix = df_train.corr()
        sns.heatmap(corr_matrix, annot = True , cmap = 'coolwarm', linewidths=.4, fmt=".2f")
        st.pyplot(fig)  


    st.subheader("3.Box-plot")
    if st.checkbox("1)í’ˆëª©ì— ë”°ë¥¸ ê°€ê²©ê³¼ ê³µê¸‰ëŸ‰ ë¹„êµ"):
        fig, ax =  plt.subplots(1,2, figsize =(10, 8))
        sns.boxplot(data = df_train, x='item', y='price(ì›/kg)', ax = ax[0])
        ax[0].set_title('í’ˆëª©ì— ë”°ë¥¸ ê°€ê²© box-plot')
       
        sns.boxplot(data = df_train, x='item', y='supply(kg)', ax = ax[1])
        ax[1].set_title('í’ˆëª©ì— ë”°ë¥¸ ê³µê¸‰ëŸ‰ box-plot')
        st.pyplot(fig)        
    
    if st.checkbox("2)í’ˆëª©ì— ë”°ë¥¸ ê°€ê²©ê³¼ ê³µê¸‰ëŸ‰"):
        item = st.selectbox('item(í’ˆëª©)', options = df_train['item'].unique(), key='item_selectbox_3')

        fig, ax =  plt.subplots(1,2, figsize =(10, 8))
        sns.boxplot(data = df_train[df_train['item'] == item], x='item', y='price(ì›/kg)', ax = ax[0])
        ax[0].set_title(f'{item}ì— ë”°ë¥¸ ê°€ê²© box-plot')
       
        sns.boxplot(data = df_train[df_train['item'] == item], x='item', y='supply(kg)', ax = ax[1])
        ax[1].set_title(f'{item}ì— ë”°ë¥¸ ê³µê¸‰ëŸ‰ box-plot')
        st.pyplot(fig)

    if st.checkbox("3)ë²•ì¸ì— ë”°ë¥¸ ê°€ê²©ê³¼ ê³µê¸‰ëŸ‰ ë¹„êµ"):    
        fig, ax =  plt.subplots(1,2, figsize =(10, 8))
        sns.boxplot(data = df_train, x='corporation', y='price(ì›/kg)', ax = ax[0])
        ax[0].set_title('ë²•ì¸ì— ë”°ë¥¸ ê°€ê²© box-plot')
       
        sns.boxplot(data = df_train, x='corporation', y='supply(kg)', ax = ax[1])
        ax[1].set_title('ë²•ì¸ì— ë”°ë¥¸ ê³µê¸‰ëŸ‰ box-plot')
        st.pyplot(fig)   

    if st.checkbox("4)ë²•ì¸ì— ë”°ë¥¸ ê°€ê²©ê³¼ ê³µê¸‰ëŸ‰"):    
        corp = st.selectbox('corporation(ë²•ì¸)',options = df_train['corporation'].unique())
        fig, ax =  plt.subplots(1,2, figsize =(10, 8))
        sns.boxplot(data = df_train[df_train['corporation']== corp], x='corporation', y='price(ì›/kg)', ax = ax[0])
        ax[0].set_title(f'{corp}ë²•ì¸ ê°€ê²© box-plot')
       
        sns.boxplot(data = df_train[df_train['corporation']== corp], x='corporation', y='supply(kg)', ax = ax[1])
        ax[1].set_title(f'{corp}ë²•ì¸ ê³µê¸‰ëŸ‰ box-plot')
        st.pyplot(fig)  

    if st.checkbox("5)ì§€ì—­ì— ë”°ë¥¸ ê°€ê²©ê³¼ ê³µê¸‰ëŸ‰ ë¹„êµ", help= 'J: ì œì£¼ì‹œ, S:ì„œê·€í¬ì‹œ'):    
        fig, ax =  plt.subplots(1,2, figsize =(10, 8))
        sns.boxplot(data = df_train, x='location', y='price(ì›/kg)', ax = ax[0])
        ax[0].set_title('ì§€ì—­ì— ë”°ë¥¸ ê°€ê²© box-plot')
       
        sns.boxplot(data = df_train, x='location', y='supply(kg)', ax = ax[1])
        ax[1].set_title('ì§€ì—­ì— ë”°ë¥¸ ê³µê¸‰ëŸ‰ box-plot')
        st.pyplot(fig) 

    if st.checkbox("6)ì§€ì—­ì— ë”°ë¥¸ ê°€ê²©ê³¼ ê³µê¸‰ëŸ‰", help= 'J: ì œì£¼ì‹œ, S:ì„œê·€í¬ì‹œ'):
        location = st.selectbox('location(ì§€ì—­)',options = df_train['location'].unique())    
        fig, ax =  plt.subplots(1,2, figsize =(10, 8))
        sns.boxplot(data = df_train[df_train['location']== location], x='corporation', y='price(ì›/kg)', ax = ax[0])
        ax[0].set_title(f'{location}ì§€ì—­ ê°€ê²© box-plot')
       
        sns.boxplot(data = df_train[df_train['location']== location], x='corporation', y='supply(kg)', ax = ax[1])
        ax[1].set_title(f'{location}ì§€ì—­ ê³µê¸‰ëŸ‰ box-plot')
        st.pyplot(fig)

    if st.checkbox("7)íœ´ì¼ì—¬ë¶€ì— ë”°ë¥¸ ê°€ê²© ë¹„êµ"):
        fig, ax = plt.subplots(3, 1, figsize=(10, 12))
        sns.barplot(data= df_train,x='item',y='price(ì›/kg)',hue='holiday',ax=ax[0])
        sns.barplot(data=df_train,x='corporation',y='price(ì›/kg)',hue='holiday',ax=ax[1])
        sns.barplot(data=df_train,x='location',y='price(ì›/kg)',hue='holiday',ax=ax[2])
        st.pyplot(fig) 

    if st.checkbox("8)íœ´ì¼ì—¬ë¶€ì— ë”°ë¥¸ ê°€ê²© ê³µê¸‰ëŸ‰ ë¹„êµ"):
        fig, ax = plt.subplots(3, 1, figsize=(10, 14))
        sns.barplot(data= df_train,x='item',y='supply(kg)',hue='holiday',ax=ax[0])
        sns.barplot(data=df_train,x='corporation',y='supply(kg)',hue='holiday',ax=ax[1])
        sns.barplot(data=df_train,x='location',y='supply(kg)',hue='holiday',ax=ax[2])
        st.pyplot(fig)         

    st.subheader("4.Scatter-plot")
    if st.checkbox("1)í’ˆëª©ì— ë”°ë¥¸ ê°€ê²©ê³¼ ê³µê¸‰ëŸ‰ Scatter-plot",help = "TG : ê°ê·¤, BC : ë¸Œë¡œì½œë¦¬, RD : ë¬´, CR : ë‹¹ê·¼, CB : ì–‘ë°°ì¶” "):
        item = st.selectbox('item(í’ˆëª©)', options = df_train['item'].unique(), key='item_selectbox_4') 
        fig, ax =  plt.subplots(1,1, figsize =(10, 10))
        sns.scatterplot(data = df_train[df_train['item']== item], x='supply(kg)', y='price(ì›/kg)', ax = ax)
        ax.set_title(f'{item}ì— ë”°ë¥¸ ê°€ê²©ê³¼ ê³µê¸‰ëŸ‰ Scatter-plot')
        st.pyplot(fig)        

    if st.checkbox("2)ì‹œê°„ì— ë”°ë¥¸ ê³µê¸‰ëŸ‰ Scatter-plot",help = "TG : ê°ê·¤, BC : ë¸Œë¡œì½œë¦¬, RD : ë¬´, CR : ë‹¹ê·¼, CB : ì–‘ë°°ì¶” "):
        item = st.selectbox('item(í’ˆëª©)', options = df_train['item'].unique(), key='item_selectbox_5')
        fig, ax = plt.subplots(1, 1, figsize=(10, 10))
        min_date, max_date = st.slider("ë‚ ì§œ ë²”ìœ„ ì„ íƒ:", 
                                   min_value=df_train['timestamp'].min(),
                                   max_value=df_train['timestamp'].max(),
                                   value=(df_train['timestamp'].min(), df_train['timestamp'].max()))
        min_date, max_date = pd.to_datetime(min_date), pd.to_datetime(max_date)
        ax.scatter(data = df_train[(df_train['item']== item) & (df_train['timestamp'] >= min_date) & (df_train['timestamp'] <= max_date)],x = 'timestamp', y ='supply(kg)' ,marker='o', color='b')
        ax.set_title(f'{item} ê³µê¸‰ëŸ‰')
        ax.set_xlabel('ë‚ ì§œ')
        ax.set_ylabel('ê³µê¸‰ëŸ‰') 
        ax.xaxis.set_major_formatter(mdates.DateFormatter('%Y'))
        ax.xaxis.set_major_locator(mdates.MonthLocator(bymonth=(12)))
        ax.tick_params(axis='x', rotation=45)
        st.pyplot(fig) 

    if st.checkbox("3)ì‹œê°„ì— ë”°ë¥¸ ê°€ê²© Scatter-plot",help = "TG : ê°ê·¤, BC : ë¸Œë¡œì½œë¦¬, RD : ë¬´, CR : ë‹¹ê·¼, CB : ì–‘ë°°ì¶” "):
        item = st.selectbox('item(í’ˆëª©)', options = df_train['item'].unique(), key='item_selectbox_6')
        fig, ax = plt.subplots(1, 1, figsize=(10, 10))
        min_date, max_date = st.slider("ë‚ ì§œ ë²”ìœ„ ì„ íƒ:", 
                                   min_value=df_train['timestamp'].min(),
                                   max_value=df_train['timestamp'].max(),
                                   value=(df_train['timestamp'].min(), df_train['timestamp'].max()))
        min_date, max_date = pd.to_datetime(min_date), pd.to_datetime(max_date)
        ax.scatter(data = df_train[(df_train['item']== item) & (df_train['timestamp'] >= min_date) & (df_train['timestamp'] <= max_date)],x = 'timestamp', y = 'price(ì›/kg)' ,marker='o', color='g')
        ax.set_title(f'{item} ê°€ê²©')
        ax.set_xlabel('ë‚ ì§œ')
        ax.set_ylabel('ê°€ê²©')
        ax.xaxis.set_major_formatter(mdates.DateFormatter('%Y'))
        ax.xaxis.set_major_locator(mdates.MonthLocator(bymonth=(12)))
        ax.tick_params(axis='x', rotation=45)
        st.pyplot(fig)  

    st.subheader("5.line-plot",help = "ë¹„êµë¥¼ ìœ„í•´ ìŠ¤ì¼€ì¼ë§ ì§„í–‰")
    if st.checkbox("1)ìˆ˜ì…ê¸ˆì•¡ - ê°€ê²© line-plot",help = "TG : ê°ê·¤, BC : ë¸Œë¡œì½œë¦¬, RD : ë¬´, CR : ë‹¹ê·¼, CB : ì–‘ë°°ì¶” "):
        item = st.selectbox('item(í’ˆëª©)', options = df_train['item'].unique(), key='item_selectbox_7')
        fig = plt.figure(figsize=(10,10))
        filter_df = df_train[df_train['item']== item].groupby(['timestamp(M)'])[['ìˆ˜ì… ì¤‘ëŸ‰','ìˆ˜ì… ê¸ˆì•¡']].sum()
        filter_df = scale_columns(filter_df, ['ìˆ˜ì… ì¤‘ëŸ‰','ìˆ˜ì… ê¸ˆì•¡'])
        filter_df1 = df_train[df_train['item']== item].groupby(['timestamp(M)'])[['supply(kg)','price(ì›/kg)']].mean()
        filter_df1 = scale_columns(filter_df1, ['supply(kg)','price(ì›/kg)'])
        plt.plot(np.arange(len(filter_df.index)), filter_df['ìˆ˜ì… ê¸ˆì•¡'].to_numpy(), label = "ìˆ˜ì… ê¸ˆì•¡" )
        plt.plot(np.arange(len(filter_df1.index)), filter_df1['price(ì›/kg)'].to_numpy(), label = "price(ì›/kg)" )
        plt.title("ìˆ˜ì…ê¸ˆì•¡ & ê°€ê²© ë¹„êµ ")
        plt.legend()
        st.pyplot(fig)

    if st.checkbox("2)ìˆ˜ì…ì¤‘ëŸ‰ - ê³µê¸‰ëŸ‰ line-plot",help = "TG : ê°ê·¤, BC : ë¸Œë¡œì½œë¦¬, RD : ë¬´, CR : ë‹¹ê·¼, CB : ì–‘ë°°ì¶” "):
        item = st.selectbox('item(í’ˆëª©)', options = df_train['item'].unique(), key='item_selectbox_8')
        fig = plt.figure(figsize=(10,10))
        filter_df = df_train[df_train['item']== item].groupby(['timestamp(M)'])[['ìˆ˜ì… ì¤‘ëŸ‰','ìˆ˜ì… ê¸ˆì•¡']].sum()
        filter_df = scale_columns(filter_df, ['ìˆ˜ì… ì¤‘ëŸ‰','ìˆ˜ì… ê¸ˆì•¡'])
        filter_df1 = df_train[df_train['item']== item].groupby(['timestamp(M)'])[['supply(kg)','price(ì›/kg)']].mean()
        filter_df1 = scale_columns(filter_df1, ['supply(kg)','price(ì›/kg)'])
        plt.plot(np.arange(len(filter_df.index)), filter_df['ìˆ˜ì… ì¤‘ëŸ‰'].to_numpy(), label = "ìˆ˜ì… ì¤‘ëŸ‰" )
        plt.plot(np.arange(len(filter_df1.index)), filter_df1['supply(kg)'].to_numpy(), label = "supply(kg)" )
        plt.title("ìˆ˜ì… ì¤‘ëŸ‰ & ê³µê¸‰ëŸ‰ ë¹„êµ ")
        plt.legend()
        st.pyplot(fig)

    if st.checkbox("3)ê°€ê²© - ê³µê¸‰ëŸ‰ line-plot",help = "TG : ê°ê·¤, BC : ë¸Œë¡œì½œë¦¬, RD : ë¬´, CR : ë‹¹ê·¼, CB : ì–‘ë°°ì¶” "):
        item = st.selectbox('item(í’ˆëª©)', options = df_train['item'].unique(), key='item_selectbox_9')
        fig = plt.figure(figsize=(10,10))
        filter_df = df_train[df_train['item']== item].groupby(['timestamp(M)'])[['ìˆ˜ì… ì¤‘ëŸ‰','ìˆ˜ì… ê¸ˆì•¡']].sum()
        filter_df = scale_columns(filter_df, ['ìˆ˜ì… ì¤‘ëŸ‰','ìˆ˜ì… ê¸ˆì•¡'])
        filter_df1 = df_train[df_train['item']== item].groupby(['timestamp(M)'])[['supply(kg)','price(ì›/kg)']].mean()
        filter_df1 = scale_columns(filter_df1, ['supply(kg)','price(ì›/kg)'])
        plt.plot(np.arange(len(filter_df1.index)), filter_df1['price(ì›/kg)'].to_numpy(), label = "price(ì›/kg)" )
        plt.plot(np.arange(len(filter_df1.index)), filter_df1['supply(kg)'].to_numpy(), label = "supply(kg)" )
        plt.title("ê°€ê²© & ê³µê¸‰ëŸ‰ ë¹„êµ ")
        plt.legend()
        st.pyplot(fig)

    st.subheader("6.kde-plot")
    if st.checkbox("1) price Kde-plot"):
        item = st.selectbox('item(í’ˆëª©)', options = df_train['item'].unique(), key='item_selectbox_10')
        fig , ax = plt.subplots() 
        sns.kdeplot(data = df_train[df_train['item']== item]['price(ì›/kg)'], shade = True)
        ax.set_title("KDE plot of price(ì›/kg)")
        ax.set_xlabel('price(ì›/kg)')
        st.pyplot(fig)

    if st.checkbox("2) supply Kde-plot"):
        item = st.selectbox('item(í’ˆëª©)', options = df_train['item'].unique(), key='item_selectbox_11')
        fig , ax = plt.subplots() 
        sns.kdeplot(data = df_train[df_train['item']== item]['supply(kg)'], shade = True)
        ax.set_title("KDE plot of price(ì›/kg)")
        ax.set_xlabel('supply(kg)')
        st.pyplot(fig)



elif page == "4) ë°ì´í„° ì „ì²˜ë¦¬":
    st.header("ë°ì´í„° ì „ì²˜ë¦¬")
    if st.checkbox("âŒ¨ï¸ ì´ìƒì¹˜ì²˜ë¦¬"):
        st.subheader("1. ì´ìƒì¹˜ ì²˜ë¦¬ ")
        st.markdown("### - Supply(kg) ì´ìƒì¹˜ í™•ì¸")
        code = '''
        list = [(tg_df, 'ê°ê·¤'), (bc_df, 'ë¸Œë¡œì½œë¦¬'), (rd_df, 'ë¬´'), (cr_df, 'ë‹¹ê·¼'), (cb_df, 'ì–‘ë°°ì¶”')]

        for df, _ in list:
        if df is rd_df:
            contamination=0.009
        elif df is cr_df:
            contamination=0.01
        else:
            contamination=0.005

        model = IsolationForest(contamination = contamination)
        model.fit(df[['supply(kg)']])
        supply_outliers = model.predict(df[['supply(kg)']])
        df['supply_outlier'] = supply_outliers

        fig, ax = plt.subplots(figsize=(5,5))
        anomaly = df.loc[df['supply_outlier'] == -1, ['supply(kg)']]
        ax.scatter(df.index, df['supply(kg)'], color = 'black', label = 'supply(kg)')
        ax.scatter(anomaly.index, anomaly['supply(kg)'], color = 'red', label = 'Anomaly')
        plt.title(f'{_} supply(kg) ì´ìƒì¹˜' )

        plt.legend()
        plt.show()  '''
        st.code(code, language='python') 
        image1 = Image.open( "/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /á„‰á…¡á„Œá…µá†«/1.png")
        image2 = Image.open( "/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /á„‰á…¡á„Œá…µá†«/2.png")
        image3 = Image.open( "/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /á„‰á…¡á„Œá…µá†«/3.png")
        image4 = Image.open( "/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /á„‰á…¡á„Œá…µá†«/4.png")
        image5 = Image.open( "/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /á„‰á…¡á„Œá…µá†«/5.png")
        image6 = Image.open( "/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /á„‰á…¡á„Œá…µá†«/5.png")
        image7 = Image.open( "/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /á„‰á…¡á„Œá…µá†«/5.png")
        image8 = Image.open( "/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /á„‰á…¡á„Œá…µá†«/5.png")
        image9 = Image.open( "/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /á„‰á…¡á„Œá…µá†«/5.png")
        image10 = Image.open( "/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /á„‰á…¡á„Œá…µá†«/5.png")
        images = [image1,image2,image3,image4,image5]

        st.image(images, width =350 ,caption=['ê°ê·¤','ë¸Œë¡œì½œë¦¬','ë¬´','ë‹¹ê·¼','ì–‘ë°°ì¶”'])


        st.markdown("### - Price(ì›/Kg) ì´ìƒì¹˜ í™•ì¸")
        code = '''
        list = [(tg_df, 'ê°ê·¤'), (bc_df, 'ë¸Œë¡œì½œë¦¬'), (rd_df, 'ë¬´'), (cr_df, 'ë‹¹ê·¼'), (cb_df, 'ì–‘ë°°ì¶”')]

        for df, _ in list:
        if df is rd_df:
            contamination=0.009
        elif df is cr_df:
            contamination=0.01
        else:
            contamination=0.005
        
        model = IsolationForest(contamination = contamination)
        model.fit(df[['price(ì›/kg)']])
        price_outliers = model.predict(df[['price(ì›/kg)']])
        df['price_outlier'] = price_outliers

        fig, ax = plt.subplots(figsize=(5,5))
        anomaly = df.loc[df['price_outlier'] == -1, ['price(ì›/kg)']]
        ax.scatter(df.index, df['price(ì›/kg)'], color = 'black', label = 'price(ì›/kg)')
        ax.scatter(anomaly.index, anomaly['price(ì›/kg)'], color = 'red', label = 'Anomaly')
        plt.title(f'{_} price(ì›/kg) ì´ìƒì¹˜' )

        plt.legend()
        plt.show()

                '''
        st.code(code, language='python')
        images2 = [image6,image7,image8,image9,image10]
        st.image(images2, width =350 ,caption=['ê°ê·¤','ë¸Œë¡œì½œë¦¬','ë¬´','ë‹¹ê·¼','ì–‘ë°°ì¶”'])
        


        st.markdown("### - ì´ìƒì¹˜ Q3 + 1.5 * IQR ë¡œ ëŒ€ì²´")
        code = '''
        list = [(tg_df, 'ê°ê·¤'), (bc_df, 'ë¸Œë¡œì½œë¦¬'), (rd_df, 'ë¬´'), (cr_df, 'ë‹¹ê·¼'), (cb_df, 'ì–‘ë°°ì¶”')]
        for df, _ in list:   
        Q1 = df['supply(kg)'].quantile(0.25)
        Q3 = df['supply(kg)'].quantile(0.75)
        IQR = Q3 - Q1
        upper_bound = Q3 + 1.5 * IQR
        df.loc[df['supply_outlier'] == -1, 'supply(kg)'] = upper_bound

                '''
        st.code(code, language='python')
        

    if st.checkbox("âŒ¨ï¸ Min-max-scaling"):
        st.subheader("2. Min-max-scaling ")
        code = '''
        # Minmax_scaling 
        from sklearn.preprocessing import MinMaxScaler

        def scale_columns(df, columns):
        scaler = MinMaxScaler()
        df[columns] = scaler.fit_transform(df[columns])
        return df

        scaled_df = scale_columns(df_train, ['price(ì›/kg)','ìˆ˜ì… ê¸ˆì•¡'])
        scaled_df1 = scale_columns(df_train, ['price(ì›/kg)','supply(kg)'])

                '''
        st.code(code, language='python')


    if st.checkbox("âŒ¨ï¸ label encoding"):
        st.subheader("3. label encoding ")
        code = '''
        from sklearn.preprocessing import  LabelEncoder
        col = ['item','corporation', 'location','holiday']

        for i in col:
        encoder = LabelEncoder()
        df_train[i] = encoder.fit_transform(df_train[i])
        df_test[i] = encoder.transform(df_test[i])        

                '''
        st.code(code, language='python')

elif page == "5) ëª¨ë¸ë§":
    st.title("ëª¨ë¸ë§(Modeling)")
    if st.checkbox("âŒ¨ï¸ Autogluon"):
        st.subheader("1.Autogluon ")
        st.markdown('''**__:blue[AutoGluon]__**ì€ Amazonì´ ê°œë°œí•œ ì˜¤í”ˆ ì†ŒìŠ¤ ë¨¸ì‹  ëŸ¬ë‹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ, íŠ¹íˆ ìë™í™”ëœ ë¨¸ì‹  ëŸ¬ë‹(AutoML)ì— ì´ˆì ì„ 
ë§ì¶”ê³  ìˆë‹¤. ì´ ë„êµ¬ëŠ” ë°ì´í„° ê³¼í•™ìë“¤ì´ ìµœì†Œí•œì˜ ë„ë©”ì¸ ì§€ì‹ìœ¼ë¡œë„ ë³µì¡í•œ ë¨¸ì‹  ëŸ¬ë‹ ëª¨ë¸ì„ ë¹ ë¥´ê³  ì‰½ê²Œ í›ˆë ¨ì‹œí‚¬ ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŒ. 
AutoGluonì˜ ì£¼ìš” íŠ¹ì§•ê³¼ ì¥ì ì€ ë‹¤ìŒê³¼ ê°™ë‹¤''') 
        st.markdown("1) **__:blue[ì‚¬ìš©ì˜ ìš©ì´ì„±]__** : ëª‡ì¤„ì˜ ì½”ë“œë§Œìœ¼ë¡œ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³  ëª¨ë¸ì„ í›ˆë ¨ì‹œí‚´")
        st.markdown('''2) **__:blue[ìë™í™”ëœ ëª¨ë¸ ì„ íƒê³¼ í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹]__** : ì´ ê³¼ì •ì€ í†µìƒì ìœ¼ë¡œ ë§ì€ ì‹œê°„ê³¼ ì „ë¬¸ ì§€ì‹ì„ ìš”êµ¬í•˜ì§€ë§Œ, 
                    AutoGluonì€ ì´ë¥¼ ìë™í™”í•¨ìœ¼ë¡œì¨ ê³¼ì •ì„ ë‹¨ìˆœí™” ì‹œì¼œì¤Œ''')
        st.markdown("3) **__:blue[ì•™ìƒë¸” í•™ìŠµê³¼ ìŠ¤íƒí‚¹]__** : ì—¬ëŸ¬ ëª¨ë¸ì˜ ì˜ˆì¸¡ì„ ê²°í•©í•˜ì—¬ ì„±ëŠ¥ì„ í–¥ìƒ ì‹œí‚¤ëŠ” ì•™ìƒë¸” í•™ìŠµê³¼ ìŠ¤íƒí‚¹ ê¸°ë²•ì„ ìë™ìœ¼ë¡œ ì ìš©")

    

        st.subheader("2.Hyper parameter ")
        st.markdown("1) **__:red[train_data = df_train]__**  : í›ˆë ¨ ë°ì´í„°ì…‹")    
        st.markdown("2) **__:red[presets='best_quality']__**  : ì˜ˆì¸¡ ì •í™•ë„ë¥¼ ìš°ì„ ì‹œí•˜ëŠ” ìµœìƒì˜ í’ˆì§ˆ ì„¤ì •ì„ ì‚¬ìš©")    
        st.markdown("3) **__:red[auto_stack = True:]__** ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ ìë™ìœ¼ë¡œ ëª¨ë¸ ìŠ¤íƒœí‚¹ì„ ìˆ˜í–‰")    
        st.markdown("4) **__:red[fit_weighted_ensemble = True]__**  : ëª¨ë“  ëª¨ë¸ì˜ ê°€ì¤‘ ì•™ìƒë¸”ì„ í•™ìŠµí•˜ì—¬ ì˜ˆì¸¡ ì„±ëŠ¥ì„ í–¥ìƒ")    
        st.markdown("5) **__:red[num_bag_folds = n]__**  : ê³¼ì í•©ì„ ì¤„ì´ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” nê²¹ì˜ ë°°ê¹…ì„ ì‚¬ìš©")    
        st.markdown("6) **__:red[num_bag_sets = n]__**  : ì„±ëŠ¥ì„ ì•ˆì •í™”í•˜ê¸° ìœ„í•´ ë°°ê¹…ì„ níšŒ ë°˜ë³µ")    
        st.markdown("7) **__:red[num_stack_levels = n]__**  : ì´ì „ ë ˆë²¨ì˜ ëª¨ë¸ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒˆë¡œìš´ ëª¨ë¸ì„ êµ¬ì¶•í•˜ëŠ” nê°œì˜ ìŠ¤íƒœí‚¹ ë ˆë²¨ì„ ë§Œë“¬")    
        st.markdown("8) **__:red[num_gpus = 1]__**  : GPU ì‚¬ìš©ê°œìˆ˜")    
        st.markdown("9) **__:red[num_cpus = cpu]__** :  ì‚¬ìš©ê°œìˆ˜")    
        st.markdown("10) **__:red[verbosity = 2]__**:  í›ˆë ¨ ê³¼ì • ì¤‘ ìƒì„¸í•œ ë¡œê·¸ë¥¼ ì¶œë ¥")    
        


        st.subheader("3.Code ")
        code = '''
        # ë¶ˆí•„ìš” ì»¬ëŸ¼ ì‚­ì œ 
        df_train = TabularDataset(df_train)
        df_test = TabularDataset(df_test)

        predictor = TabularPredictor(label='price(ì›/kg)',
                             eval_metric='rmse',
                             problem_type= 'regression')

        predictor.fit(train_data = df_train,
              presets='best_quality',
              auto_stack = True, fit_weighted_ensemble = True,
              num_bag_folds = 10, num_bag_sets = 2, num_stack_levels = 2,
              verbosity = 2
              )
        ld_board = predictor.leaderboard(df_train, silent=True)

        pred_y = predictor.predict(df_test)
        pred_y


                '''
        st.code(code, language='python')
        code = "ld_board = predictor.leaderboard(df_train, silent=True)"
        st.markdown("í•™ìŠµê³¼ì •") 
        url ="/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /á„‰á…¡á„Œá…µá†«/15.png"
        st.image(url, caption = ' ') 
        st.markdown("í•™ìŠµê²°ê³¼") 
        st.code(code, language='python')
        url1 = "/Users/seungho/Desktop/á„‰á…³á†¼á„’á…©/á„€á…©á†¼á„†á…©á„Œá…¥á†« á„†á…µá†¾ á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„ƒá…¦á„‹á…µá„á…©á†«/á„ƒá…¦á„‹á…µá„á…©á†« á„Œá…¦á„Œá…®á„á…³á†¨á„‰á…¡á†«á„†á…®á†¯á„€á…¡á„€á…§á†¨á„‹á…¨á„á…³á†¨ /á„‰á…¡á„Œá…µá†«/14.png"
        st.image(url1, caption = ' ')
